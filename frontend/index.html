<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>waxbarohub</title>
  <link rel="stylesheet" href="css/style.css" />
  

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Minimal professional responsive CSS (you can replace with your theme) */
    :root{ --bg:#f8fafc; --card:#fff; --muted:#6b7280; --accent:#2563eb; --gap:12px; --radius:8px; font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
    body{ margin:0; background:var(--bg); color:#0f172a; }
    header.header{ display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(90deg,#0ea5a8,#2563eb);color:#fff; position:sticky; top:0; z-index:40 }
    .brand{ font-weight:700; font-size:18px }
    nav{ display:flex; align-items:center; gap:12px }
    .hamburger{ background:transparent;border:0;color:inherit;font-size:20px;display:none }
    .nav{ list-style:none;margin:0;padding:0;display:flex;gap:8px;align-items:center }
    .nav li{ padding:8px 12px;border-radius:6px; cursor:pointer }
    .nav li:hover{ background:rgba(255,255,255,0.12) }
    .container{ padding:16px; max-width:1100px;margin:18px auto; }
    .page h2{ margin-top:0; display:flex; align-items:center; gap:10px }
    .card{ background:var(--card); border-radius:8px; padding:12px; box-shadow:0 1px 3px rgba(2,6,23,0.06); margin-bottom:10px }
    .btn{ background:var(--accent); color:#fff; border:0; padding:8px 10px; border-radius:6px; cursor:pointer }
    input,select,textarea{ padding:8px;border-radius:6px;border:1px solid #e6eef8;width:100%;box-sizing:border-box;margin-top:6px;margin-bottom:8px }
    .filters{ margin-bottom:10px }
    .modal{ position:fixed; inset:0; background:rgba(2,6,23,0.4); display:flex; align-items:center; justify-content:center; z-index:80 }
    .modal.hidden{ display:none }
    .modal-dialog{ width:96%; max-width:720px; background:var(--card); border-radius:10px; padding:16px; position:relative }
    .close{ position:absolute; right:8px; top:8px; background:#efefef;border:0;border-radius:50%; width:34px;height:34px; font-size:18px; cursor:pointer }
    @media (max-width:900px){
      .nav{ display:none; position:absolute; left:0; top:56px; background:#fff; width:100%; flex-direction:column; box-shadow:0 6px 20px rgba(2,6,23,0.08); }
      .hamburger{ display:inline-block }
      .nav.open{ display:flex }
      header.header{ position:sticky; }
    }
    /* small helpers */
    .muted{ color:var(--muted); font-size:13px }
    
  /* Basic utility-ish CSS to make the template look polished */
  .card { background:#fff;
    border-radius:10px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,0.06); }
  .btn { background:#2563eb;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer; }
  .btn--outline { background:transparent;border:1px solid #d1d5db;color:#111;padding:6px 10px;border-radius:8px; }
  .payments-card { width:100%; display:flex;flex-direction:column;align-items:start;padding:14px;border-radius:12px; }
  @media(min-width:640px){ .payments-card { width:48%; } .payments-app { margin-top:20px; } .payments-detail{ display:block; } }
  .payments-card__title { font-weight:700;font-size:18px;margin-bottom:6px; }
  .payments-card__summary { color:#6b7280; font-size:14px; }
  .chip { background:#eef2ff;padding:6px 10px;border-radius:999px;cursor:pointer;border:1px solid transparent;white-space:nowrap; }
  .chip[aria-pressed="true"] { background:#c7d2fe;border-color:#6366f1; color:#111; font-weight:600; }
  .status-badge { padding:4px 8px;border-radius:999px;font-weight:600;font-size:12px; }
  .status-paid { background:#ecfdf5;color:#065f46; }
  .status-partial { background:#fffbeb;color:#92400e; }
  .status-unpaid { background:#fff1f2;color:#9f1239; }
  .payments-row { display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px; }
  .payments-row .meta { color:#6b7280;font-size:13px; }
  .toast { position:fixed;right:12px;bottom:12px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;box-shadow:0 6px 20px rgba(2,6,23,0.4); z-index:2000; }
  .month-pill{ padding:6px 8px;border-radius:999px;border:1px solid #e5e7eb;margin:4px;display:inline-block;cursor:pointer; }
  .month-pill[aria-pressed="true"]{ background:#e0e7ff;border-color:#6366f1;color:#111 }
</style>
</head>
<body>
  <header class="header">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="brand">Manager Study</div>
    </div>
    <nav>
      <button id="hambtn" class="hamburger" aria-label="menu">☰</button>
      <ul id="nav" class="nav">
        <li data-route="dashboard" data-role="admin,manager">Dashboard</li>
        <li data-route="students" data-role="admin,manager">Students</li>
        <li data-route="teachers" data-role="admin,manager">Teachers</li>
        <li data-route="subjects" data-role="admin,manager">Subjects</li>
        <li data-route="classes" data-role="admin,manager">Classes</li>
        <li data-route="parents" data-role="admin,manager">Parents</li>
        <li data-route="attendance" data-role="teacher,manager,admin ,student,parent">Attendance</li>
        <li data-route="game" >Game</li>

        <li data-route="profile" data-role="student,teacher,parent">Profile</li>
        <li data-route="results" data-role="student,parent">Results</li>
        <li data-route="finance" data-role="parent">Finance</li>
        <li data-route="finance" data-role="parent">Finance</li>

        <li data-route="chats" data-role="manager,teacher,student">Chats</li>
        <li data-route="meetings" data-role="admin,manager,teacher,student ,parent">Meetings</li>
        <li data-route="payments" data-role="admin,manager">Payments</li>
        <li data-route="exams" data-role="admin,manager">Exams</li>
        <li data-route="quizzes" data-role="admin,manager,teacher,student">Quizzes</li>
        <li data-route="notices">Notices</li>
        <li data-route="about">About</li>
        <li data-route="user-management" data-role="admin">User Management</li>
        <li data-route="vote"  data-role="admin,manager,teacher,student">Vote</li>
        <li data-route="help"  data-role="admin,manager,teacher,student">Help</li>
        <li data-route="login">Login</li>
      </ul>
    </nav>
  </header>

  <main id="app" class="container"></main>

  <!-- Templates -->
  <template id="tpl-finance">
    <section class="page">
      <h2>Finance</h2>

      <div id="finance-root" style="max-width:1000px;margin:0 auto;padding:16px">
        <div id="finance-header"></div>
        <div id="finance-body" style="margin-top:12px"></div>
      </div>
    </section>
  </template>
  <template id="tpl-game">
    <section class="page math-game-page" style="padding:18px;max-width:1200px;margin:0 auto;">
      <!-- Header removed per request -->
  
      <!-- Main content area: single-page panels -->
      <div id="game-root" class="game-root">
        <!-- top area: small page heading + controls now inside content -->
        <div class="game-top card" style="margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <div>
            <h2 class="page-title" style="margin:0 0 4px 0; font-size:20px; font-weight:800;">Math Games</h2>
            <div class="page-sub" style="color:var(--muted); font-size:13px;">Practice, learn and compete — all in one place</div>
          </div>
  
          <div class="controls-block" style="display:flex; gap:12px; align-items:center;">
            <div class="filters" role="region" aria-label="Filters">
              <select id="game-period-filter" class="input select-sm" aria-label="Choose period">
                <option value="all">All-time</option>
                <option value="7">Last 7 days</option>
                <option value="30">Last 30 days</option>
              </select>
            </div>
  
            <!-- Navigation (tablist) — horizontally scrollable on small screens -->
            <div class="nav-wrapper" aria-hidden="false">
              <div class="nav-buttons" role="tablist" aria-label="Game navigation">
                <button id="nav-game" class="nav-btn active" data-panel="panel-games" role="tab" aria-selected="true">Game</button>
                <button id="nav-lesson" class="nav-btn" data-panel="panel-lessons" role="tab" aria-selected="false">Lesson</button>
                <button id="nav-leaderboard" class="nav-btn" data-panel="panel-leaderboard" role="tab" aria-selected="false">Leaderboard</button>
                <button id="nav-recent" class="nav-btn" data-panel="panel-recent" role="tab" aria-selected="false">Recent games</button>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Games panel -->
        <main id="panel-games" class="panel active-panel" role="region" aria-label="Games">
          <div class="left-col">
            <div id="math-summary"></div>
            <div id="math-search-wrap" class="search-wrap"></div>
            <div id="math-types-list" class="math-types-grid" aria-live="polite"></div>
          </div>
  
          <aside class="right-col">
            <div class="card muted-block" style="margin-bottom:12px">
              <div id="my-summary" aria-live="polite"></div>
            </div>
  
            <div class="card leaderboard-card" id="leaderboard-side-card" aria-hidden="true">
              <div class="card-h" style="align-items:center;justify-content:space-between">
                <div class="muted">Leaderboard (quick)</div>
                <button id="leaderboard-refresh" class="btn btn--outline">Refresh</button>
              </div>
              <div id="leaderboard-body" style="margin-top:8px">Select a math type to view leaderboard</div>
            </div>
  
            <div class="card" style="margin-top:12px">
              <h4 style="margin:0 0 8px 0">Your recent games</h4>
              <div id="my-games" style="margin-top:8px"></div>
            </div>
          </aside>
        </main>
  
        <!-- Lessons panel -->
        <section id="panel-lessons" class="panel" role="region" aria-label="Lessons" hidden>
          <div class="lessons-intro">
            <h3 style="margin:0 0 10px 0">Lessons</h3>
            <div class="small-muted">Learning resources and worked examples. Click "Open Lessons" to browse lessons. Admins can manage lessons in the modal.</div>
            <div style="margin-top:12px">
              <button id="open-lessons-btn" class="btn">Open Lessons</button>
            </div>
          </div>
        </section>
  
        <!-- Leaderboard panel -->
        <section id="panel-leaderboard" class="panel" role="region" aria-label="Leaderboard" hidden>
          <div class="card">
            <div id="leaderboard-header" class="leaderboard-header">Leaderboard</div>
            <div id="leaderboard-full" style="margin-top:8px">
              <div id="leaderboard-body-full" class="muted">Use a math type to show leaderboard, or search & choose a game first.</div>
            </div>
          </div>
        </section>
  
        <!-- Recent games panel -->
        <section id="panel-recent" class="panel" role="region" aria-label="Recent games" hidden>
          <div class="card">
            <h3 style="margin:0 0 8px 0">Your recent games</h3>
            <div id="my-games-full" class="muted">Loading…</div>
          </div>
        </section>
      </div>
  
      <!-- Modal root -->
      <div id="math-game-modal-root" aria-hidden="true" style="display:block;pointer-events:none"></div>
  
      <style>
        :root { --accent: #2563eb; --muted: #6b7280; --card-bg:#fff; --shadow: 0 10px 30px rgba(2,6,23,0.06); }
  
        /* game top (replaces previous header) */
        .game-top { background:transparent; padding:12px 14px; border-radius:8px; display:flex; align-items:center; justify-content:space-between; }
  
        .page-title { color: #0f172a; }
        .page-sub { color: var(--muted); font-size:13px; }
  
        /* nav row — horizontal scroll on small screens */
        .nav-wrapper { display:flex; align-items:center; min-width:0; max-width:720px; }
        .nav-buttons { display:flex; gap:10px; align-items:center; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px; scrollbar-width: none; -ms-overflow-style: none; }
        .nav-buttons::-webkit-scrollbar { display: none; }
  
        .nav-btn { flex:0 0 auto; padding:8px 14px; border-radius:999px; background:transparent; cursor:pointer; font-weight:700; color:#111827; transition:all .15s ease; white-space:nowrap; }
        .nav-btn.active { background: linear-gradient(90deg,var(--accent),#7c3aed); color:#fff; box-shadow:0 8px 20px rgba(37,99,235,0.12); }
  
        /* layout */
        .game-root { display:flex; flex-direction:column; gap:12px; margin-top:8px; max-width:1200px; margin-left:auto; margin-right:auto; }
        .panel { display:flex; gap:16px; align-items:flex-start; }
        .panel .left-col { flex:1; min-width:0; }
        .panel .right-col { width:360px; flex:0 0 360px; }
        .math-types-grid { display:grid; grid-template-columns: 1fr; gap:12px; }
        @media(min-width:980px) { .math-types-grid { grid-template-columns: 1fr 1fr; } }
  
        .card { background:var(--card-bg); border-radius:12px; padding:12px; box-shadow: var(--shadow); border:1px solid rgba(15,23,42,0.03); }
        .muted-block { background:linear-gradient(180deg,#fbfdff,#fff); border-radius:10px; padding:12px; }
  
        .search-wrap { margin-bottom:10px; }
        input.input, select.input { width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6e9ee; box-sizing:border-box; }
  
        .math-game-card { border:1px solid #e6e9ee; padding:14px; border-radius:10px; background:linear-gradient(180deg,#fff,#fbfdff); display:flex; flex-direction:column; gap:10px; }
        .math-actions { display:flex; gap:8px; flex-wrap:wrap; }
        .answer-btn, .btn { border-radius:8px; padding:8px 10px; cursor:pointer; }
  
        .leaderboard-card { position:relative; }
        .panel[hidden] { display:none !important; }
  
        @media(max-width:900px) {
          .panel { flex-direction:column-reverse; }
          .panel .right-col { width:100%; flex:auto; }
          .game-top { flex-direction:column; align-items:flex-start; gap:12px; }
          .nav-wrapper { width:100%; }
          .nav-buttons { width:100%; padding-top:6px; }
        }
        @media(max-width:520px) {
          .nav-btn { padding:6px 10px; font-size:14px; }
          .page-title { font-size:18px; }
        }
  
        /* modal root inert default */
        #math-game-modal-root { pointer-events:none; }
        #math-game-modal-root > .modal { pointer-events:auto; }
  
        .small-muted { font-size:12px; color:var(--muted); }
        .leaderboard-header { font-weight:700; }
        .active-panel { display:flex; }
      </style>
    </section>
  </template>
  

  <!-- Replace tpl-chats with this template -->

<template id="tpl-chats">
  <section class="page" style="padding:12px;max-width:1200px;margin:0 auto;">
    <div style="display:flex;gap:12px;align-items:flex-start;">
      <!-- Left: classes -->
      <div id="chats-left" style="width:320px;min-width:260px;">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h2 style="margin:0">Chats</h2>
          <button id="chats-refresh" class="btn btn--outline">Refresh</button>
        </div>
        <div id="chats-classes" style="margin-top:12px"></div>

        <div style="margin-top:12px">
          <h4 style="margin:0 0 6px 0">My classes</h4>
          <div id="chats-my-classes"></div>
        </div>
      </div>

      <!-- Middle: single pane (messages / participants / media) -->
      <div id="chats-middle" style="flex:1;display:flex;flex-direction:column;gap:8px;min-width:0;/*min-width to allow shrinking*/">

        <div style="display:flex;align-items:center;justify-content:space-between">
          <div>
            <h3 id="chats-room-title" style="margin:0">Select a class</h3>
            <div id="chats-room-sub" class="muted" style="font-size:13px"></div>
          </div>
          <div class="muted" id="chats-typing" style="font-size:13px"></div>
        </div>

        <!-- Content panes (only one visible at a time) -->
        <div id="chats-content-pane" class="card" style="height:56vh; overflow:auto; padding:12px; background:#fff; display:flex;flex-direction:column;">
          <div id="chats-messages-wrap" style="flex:1; overflow:auto;"></div>
          <div id="chats-participants" style="flex:1; display:none; overflow:auto;"></div>
          <div id="chats-media" style="flex:1; display:none; overflow:auto;"></div>
        </div>

        <!-- Input area (only for messages view) -->
        <div id="chats-input-row" style="display:flex;gap:8px;align-items:center">
          <input id="chats-input" placeholder="Write a message..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #e5e7eb" />
          <input id="chats-files" type="file" multiple style="display:none" />
          <button id="chats-attach" class="btn btn--outline">Attach</button>
          <button id="chats-send" class="btn">Send</button>
        </div>

        <div id="chats-send-feedback" class="muted" style="font-size:13px;min-height:20px"></div>
      </div>
    </div>

    <!-- reaction popup -->
    <div id="chats-react-popup" style="position:fixed;display:none;background:#fff;border-radius:8px;padding:8px;box-shadow:0 6px 24px rgba(2,6,23,0.12);z-index:4000">
      <span class="react-emoji" style="cursor:pointer;padding:6px">😃</span>
      <span class="react-emoji" style="cursor:pointer;padding:6px">👍</span>
      <span class="react-emoji" style="cursor:pointer;padding:6px">❤️</span>
      <span class="react-emoji" style="cursor:pointer;padding:6px">😔</span>
      <span class="react-emoji" style="cursor:pointer;padding:6px">👎</span>
      <span class="react-emoji" style="cursor:pointer;padding:6px">😡</span>
    </div>

    <!-- small animation style -->
    <style>
      .chat-message { transition: transform .12s ease, opacity .12s ease; }
      .chat-message.enter { transform: translateY(8px); opacity: 0; animation: chatIn .18s forwards; }
      @keyframes chatIn { to { transform: translateY(0); opacity:1 } }
      .chat-message.deleted { opacity: 0.6; color:#666; text-decoration:line-through; }
      #chats-messages-wrap img { max-width:100%; border-radius:6px; display:block; }
      /* small pill for react badges */
      .react-pill { display:inline-block;padding:4px 8px;border-radius:16px;background: #f3f4f6;margin-right:6px;font-size:13px; }
    </style>
  </section>
</template>


<!-- tpl-dashboard: updated with settings dropdown -->
<template id="tpl-dashboard">
  <section class="page dashboard-page">
    <div class="dash-header">
      <div style="display:flex;align-items:center;gap:12px">
        <h1 class="dash-title" style="margin:0;display:flex;align-items:center;gap:8px;">
          Dashboard
        </h1>

        <!-- SETTINGS: appears for admin/manager via JS -->
        <div id="dashboard-settings-wrap" style="position:relative;">
          <button id="dashboard-settings-btn" class="btn settings-btn" title="Settings" aria-haspopup="true" aria-expanded="false">⚙️</button>

          <div id="dashboard-settings-dropdown" class="settings-dropdown" role="menu" aria-hidden="true" style="display:none">
            <button id="dropdown-open-recycle" class="dropdown-item" type="button" role="menuitem">♻️ Recycle bin</button>
            <button id="dropdown-edit-profile" class="dropdown-item" type="button" role="menuitem">✏️ Edit profile</button>
          </div>
        </div>
      </div>

      <div>
        <p class="dash-sub">Realtime &amp; historical payments • students • teachers</p>
      </div>

      <div class="dash-controls">
        <label class="muted">Payments range</label>
        <select id="dash-filter" class="select">
          <option value="daily">Daily (today)</option>
          <option value="weekly">Weekly (last 7 days)</option>
          <option value="monthly" selected>Monthly (this month)</option>
          <option value="yearly">Yearly (this year)</option>
          <option value="live">Live (last 5 min)</option>
          <option value="all">All time</option>
        </select>
      </div>
    </div>

    <!-- NEW: dashboard content wrapper -->
    <div id="dashboard-content">
      <div id="dash-grid" class="dash-grid" aria-live="polite"></div>

      <div class="dash-main">
        <div class="dash-left">
          <div class="card card-chart">
            <div class="card-h">
              <div>
                <div class="muted">Payments</div>
                <div id="dash-payments-paid" class="card-value card-value--payments">$0.00</div>
              </div>
              <div class="muted small">Total paid</div>
            </div>
            <div style="position:relative;height:220px">
              <canvas id="paymentsChart"></canvas>
            </div>
          </div>

          <div class="card card-top">
            <h3>Top students (largest outstanding)</h3>
            <div id="top-students" class="top-list"></div>
          </div>
        </div>

        <div class="dash-right">
          <div class="card stat-card stat-students">
            <div class="muted">Total Students</div>
            <div id="total-students" class="stat-large stat-large--students">0</div>
          </div>
          <div class="card stat-card stat-teachers">
            <div class="muted">Total Teachers</div>
            <div id="total-teachers" class="stat-large stat-large--teachers">0</div>
          </div>

          <!-- NEW: Total Managers (present in DOM but shown only to admin by JS) -->
          <div id="card-managers" class="card stat-card stat-managers" style="display:none">
            <div class="muted">Total Managers</div>
            <div id="total-managers" class="stat-large stat-large--managers">0</div>
          </div>

          <!-- NEW -->
          <div class="card stat-card stat-classes">
            <div class="muted">Total Classes</div>
            <div id="total-classes" class="stat-large stat-large--classes">0</div>
          </div>
          <div class="card stat-card stat-subjects">
            <div class="muted">Total Subjects</div>
            <div id="total-subjects" class="stat-large stat-large--subjects">0</div>
          </div>

          <div class="card stat-card stat-payments">
            <div class="muted">Payments (count)</div>
            <div id="payments-count" class="stat-large stat-large--payments">0</div>
          </div>
        </div>

      </div>
    </div>

    <!-- dash-spinner is optional; if you use it, keep it -->
    <div id="dash-spinner" class="dash-spinner" aria-hidden="true">
      <div class="spinner"></div>
    </div>

    <style>
      /* (existing CSS unchanged) */
      :root{
        --muted:#64748b;
        --card-bg:#fff;
        --shadow: 0 10px 30px rgba(2,6,23,0.06);
        --accent-students-start:#2563eb; --accent-students-end:#60a5fa;
        --accent-teachers-start:#10b981; --accent-teachers-end:#6ee7b7;
        --accent-payments-start:#7c3aed; --accent-payments-end:#a78bfa;
      }

      /* container */
      .dashboard-page { max-width:1200px; margin:18px auto; padding:18px; box-sizing:border-box; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:#0f172a; }

      /* header */
      .dash-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
      .dash-title { margin:0; font-size:20px; letter-spacing:-0.2px; }
      .dash-sub { margin:0; color:var(--muted); font-size:13px; }

      /* settings dropdown */
      .settings-btn { padding:6px 8px; border-radius:8px; border:1px solid #e6edf3; background:var(--card-bg); cursor:pointer; font-size:14px; }
      .settings-dropdown { position:absolute; right:0; top:42px; min-width:180px; background:#fff; border-radius:10px; box-shadow:0 12px 30px rgba(2,6,23,0.12); border:1px solid rgba(2,6,23,0.06); padding:8px; z-index:1200; }
      .settings-dropdown .dropdown-item { display:block; width:100%; text-align:left; padding:8px 10px; border-radius:8px; background:transparent; border:0; cursor:pointer; font-size:14px; }
      .settings-dropdown .dropdown-item:hover { background:#f8fafc; }

      /* controls */
      .dash-controls { display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
      .select { padding:8px 10px; border-radius:8px; border:1px solid #e6edf3; background:var(--card-bg); min-width:180px; box-shadow:none; font-size:13px; }

      /* grid & cards */
      .dash-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-bottom:16px; }
      .card { background:var(--card-bg); border-radius:12px; padding:14px; box-shadow: var(--shadow); border:1px solid rgba(15,23,42,0.03); }
      .card-h { display:flex; justify-content:space-between; align-items:center; gap:12px; }
      .muted { color:var(--muted); font-size:13px; }
      .card-value { font-weight:700; font-size:22px; margin-top:6px; }
      .card-value--payments { color: var(--accent-payments-start); }

      /* layout */
      .dash-main { display:flex; gap:12px; align-items:flex-start; }
      .dash-left { flex:2; display:flex; flex-direction:column; gap:12px; min-width:0; }
      .dash-right { flex:1; display:grid; grid-template-columns: 1fr; gap:12px; min-width:0; }

      .card-chart { display:flex; flex-direction:column; gap:12px; }
      .card-top h3 { margin:0 0 10px 0; font-size:16px; }
      .top-list { display:flex; flex-direction:column; gap:8px; }
      .top-item { display:flex; justify-content:space-between; align-items:center; gap:12px; padding:10px; border-radius:8px; background:#fbfdff; border:1px solid rgba(15,23,42,0.03); }
      .stat-large { font-size:20px; font-weight:700; margin-top:8px; }

      /* accent bars */
      .stat-card { position:relative; overflow:visible; padding-left:14px; }
      .stat-card::before { content:""; position:absolute; left:0; top:0; bottom:0; width:6px; border-radius:6px; transform:translateX(-50%); }
      .stat-students::before { background: linear-gradient(90deg,var(--accent-students-start),var(--accent-students-end)); box-shadow:0 6px 18px rgba(37,99,235,0.12); }
      .stat-teachers::before { background: linear-gradient(90deg,var(--accent-teachers-start),var(--accent-teachers-end)); box-shadow:0 6px 18px rgba(16,185,129,0.12); }
      .stat-payments::before { background: linear-gradient(90deg,var(--accent-payments-start),var(--accent-payments-end)); box-shadow:0 6px 18px rgba(124,58,237,0.12); }
      .stat-managers::before { background: linear-gradient(90deg,#f97316,#fb923c); box-shadow:0 6px 18px rgba(249,115,22,0.08); }

      /* number colors */
      .stat-large--students { color: var(--accent-students-start); }
      .stat-large--teachers { color: var(--accent-teachers-start); }
      .stat-large--payments { color: var(--accent-payments-start); }
      .stat-large--managers { color: #f97316; }

      /* spinner overlay */
      .dash-spinner { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(255,255,255,0.6); z-index:1200; opacity:0; pointer-events:none; transition:opacity .18s ease; }
      .dash-spinner[aria-hidden="false"] { opacity:1; pointer-events:auto; display:flex; }
      .spinner { width:48px;height:48px;border-radius:50%;border:4px solid rgba(15,23,42,0.08); border-top-color: #2563eb; animation:spin .9s linear infinite; box-shadow:0 6px 18px rgba(37,99,235,0.08); }
      @keyframes spin { to{ transform:rotate(360deg); } }

      .small { font-size:12px; color:#94a3b8; }

      /* responsive rules (unchanged) */
      @media (max-width:900px) {
        .dashboard-page { padding:12px; max-width:940px; }
        .dash-header { flex-direction:column; align-items:flex-start; gap:10px; }
        .dash-controls { order:0; align-items:flex-start; flex-direction:row; gap:8px; }
        .dash-main { flex-direction:column; align-items:center; gap:12px; }
        .dash-left, .dash-right { width:100%; max-width:100%; box-sizing:border-box; }
        .dash-left { order:1; }
        .dash-right { order:2; display:grid; grid-template-columns: repeat(2,1fr); gap:8px; width:100%; }
        .card-chart { width:100%; }
        .card-chart canvas { width:100% !important; height:auto !important; display:block; }
        .stat-card { padding-left:12px; }
        .stat-payments { grid-column: 1 / -1; }
        .dashboard-page { margin-left:auto; margin-right:auto; }
      }
      @media (max-width:520px) {
        .dash-right { grid-template-columns: 1fr 1fr; gap:8px; }
        .stat-payments { grid-column: 1 / -1; }
        .select { min-width:120px; }
      }
    </style>
  </section>
</template>






<template id="tpl-students">
  <section class="page students-page" style="padding:16px;max-width:1100px;margin:0 auto;">
    <div class="students-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;">
      <div>
        <h2 style="margin:0;font-size:20px;font-weight:800">Students</h2>
        <div class="muted" style="font-size:13px;margin-top:6px">Manage students: add, edit, reset password, or remove.</div>
      </div>

      <!-- Desktop / tablet Add Student -->
      <div style="display:flex;gap:8px;align-items:center">
        <button id="add-student-btn" class="btn btn-primary" title="Add student" style="display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;">
          <!-- plus icon -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="btn-text">Add Student</span>
        </button>
      </div>
    </div>

    <!-- Collapsible create form (hidden by default) -->
    <div id="create-student-panel" class="card create-panel" style="display:none;margin:8px 0 14px;border-radius:10px;padding:12px;background:#fff;border:1px solid rgba(15,23,42,0.04)">
      <h3 style="margin:0 0 8px 0">Create Student</h3>
      <form id="create-student-form" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;">
        <div style="display:flex;flex-direction:column">
          <label class="field-label">Full name</label>
          <input name="fullname" placeholder="Full name" required />
        </div>

        <div style="display:flex;flex-direction:column">
          <label class="field-label">Phone</label>
          <input name="phone" placeholder="Phone" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label class="field-label">Number ID (optional)</label>
          <input name="numberId" placeholder="Leave empty to auto-generate" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label class="field-label">Password (optional)</label>
          <input name="password" placeholder="Password (leave blank to generate)" />
          <small class="muted">If left blank, the server will create a one-time password and return it once.</small>
        </div>

        <div style="grid-column:1 / -1; display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button id="create-student-cancel" type="button" class="btn btn-outline">Cancel</button>
          <button id="create-student-submit" type="submit" class="btn btn-primary">Create student</button>
        </div>
      </form>
      <div id="create-student-feedback" style="margin-top:8px;font-size:13px;color:#d00;display:none"></div>
    </div>

    <!-- Search / filters -->
    <div class="students-controls" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px;">
      <input id="student-search" placeholder="Search by name or id" style="flex:1;min-width:160px;padding:10px;border-radius:10px;border:1px solid #e6eef8" />
      <select id="student-class-filter" style="padding:10px;border-radius:10px;border:1px solid #e6eef8">
        <option value="">All classes</option>
      </select>
      <div style="display:flex;gap:8px">
        <button id="students-refresh" class="btn btn-outline" title="Refresh list">Refresh</button>
      </div>
    </div>

    <!-- Students list -->
    <div id="students-list" style="display:grid;gap:10px">
      <!-- JS will populate rows here. Use the .student-row styles below. -->
      <div id="students-empty" class="muted card" style="padding:12px;border-radius:10px;border:1px dashed #e6e6e6;background:#fbfdff">No students yet. Click "Add Student" to register a new student.</div>
    </div>

    <!-- Floating Add button for small screens -->
    <button id="add-student-fab" class="fab" title="Add student" aria-label="Add student">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <style>
      /* Basic modern utilities for students template */
      .card { background:#fff; border-radius:12px; padding:12px; box-shadow:0 6px 20px rgba(2,6,23,0.04); border:1px solid rgba(15,23,42,0.03); }
      .muted { color:#6b7280; font-size:13px; }
      .field-label { font-size:13px; margin-bottom:6px; color:#111827; font-weight:600; }

      /* Buttons */
      .btn { display:inline-flex; align-items:center; gap:8px; border:0; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:600; background:transparent; color:inherit; }
      .btn-primary { background: linear-gradient(90deg,#2563eb,#7c3aed); color:#fff; box-shadow: 0 8px 18px rgba(37,99,235,0.12); }
      .btn-outline { background:transparent;border:1px solid #e6eef8;color:#111827;padding:8px 10px;border-radius:8px; }

      /* Student row layout */
      .student-row {
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
        padding:10px;
        border-radius:10px;
        background: #fff;
        border: 1px solid rgba(15,23,42,0.04);
      }
      .student-left { display:flex; gap:12px; align-items:center; min-width:0; }
      .student-avatar { width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,#eef2ff,#fff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#2563eb }
      .student-meta { min-width:0; overflow:hidden; }
      .student-name { font-weight:700; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
      .student-sub { color:var(--muted); font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

      /* Actions: icon-only buttons */
      .student-actions { display:flex; gap:8px; align-items:center; }
      .action-btn {
        width:40px; height:40px; border-radius:8px; display:inline-grid; place-items:center; border:1px solid transparent; cursor:pointer; background:transparent;
      }
      .action-btn svg { width:18px;height:18px; display:block; }
      .action-btn.edit { border-color: rgba(37,99,235,0.08); background: rgba(37,99,235,0.04); color:#2563eb; }
      .action-btn.pw { border-color: rgba(124,58,237,0.06); background: rgba(124,58,237,0.04); color:#7c3aed; }
      .action-btn.delete { border-color: rgba(239,68,68,0.06); background: rgba(239,68,68,0.04); color:#ef4444; }

      .action-btn:focus { outline:3px solid rgba(37,99,235,0.12); outline-offset:2px; }

      /* Responsive behavior */
      @media (max-width: 900px) {
        .student-row { padding:12px; }
        .student-avatar { width:44px; height:44px; }
        .student-name { font-size:14px; }
        .student-actions .action-label { display:none; }
      }

      /* Floating action button on mobile */
      .fab {
        position:fixed;
        right:18px;
        bottom:18px;
        width:56px;
        height:56px;
        border-radius:999px;
        display:none;
        align-items:center;
        justify-content:center;
        background:linear-gradient(90deg,#2563eb,#7c3aed);
        color:#fff;
        border:0;
        box-shadow:0 12px 30px rgba(37,99,235,0.18);
        z-index:1600;
        cursor:pointer;
      }
      .fab svg { width:20px;height:20px; }

      /* show fab on small screens */
      @media (max-width:640px) {
        .fab { display:flex; }
        #add-student-btn { display:none; } /* hide top Add on small screens, fab replaces it */
      }

      /* Accessibility: focus styles */
      .student-row:focus-within { box-shadow: 0 8px 26px rgba(2,6,23,0.06); border-color: rgba(37,99,235,0.06); }

    </style>


  </section>
</template>

<template id="tpl-teachers">
  <section class="page teachers-page" style="padding:12px; max-width:1100px; margin:0 auto; box-sizing:border-box;">
    <!-- Header row: title + search + add button -->
    <div class="teachers-header" style="display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;">
      <div style="display:flex;align-items:center;gap:12px;min-width:0;">
        <h2 style="margin:0;font-size:20px;line-height:1.1">Teachers</h2>
        <div class="muted" style="font-size:13px;">Manage teaching staff</div>
      </div>

      <!-- Search + Add grouped on the right (wraps on mobile) -->
      <div style="display:flex;align-items:center;gap:8px;flex:0 1 420px;min-width:220px;">
        <input id="teacher-search" aria-label="Search teachers by name or id" placeholder="Search by name or id" style="flex:1;padding:8px 10px;border-radius:10px;border:1px solid #e6eef8;box-sizing:border-box" />

        <!-- Primary add button (keeps same id so existing JS works) -->
        <button id="add-teacher-btn" class="btn" style="display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:0;background:#2563eb;color:#fff;font-weight:700;cursor:pointer;">
          <!-- plus icon -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          <span style="font-size:14px">Add</span>
        </button>
      </div>
    </div>

    <!-- Teachers grid -->
    <div id="teachers-list" class="teachers-grid" style="display:grid;gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
      <!-- JS will populate teacher cards here -->
      <!-- Example empty state: -->
      <div id="teachers-empty" class="card muted" style="display:none;padding:16px;border-radius:12px;background:#fff;border:1px dashed #e6eef8;color:#64748b">
        No teachers yet. Click Add to register a teacher.
      </div>
    </div>

    <!-- Floating action button visible on small screens (delegates to add-teacher-btn) -->
    <button id="add-teacher-fab" class="fab" aria-hidden="false" title="Add teacher" style="display:none;position:fixed;right:16px;bottom:18px;width:56px;height:56px;border-radius:999px;border:0;background:#2563eb;color:#fff;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(37,99,235,0.18);cursor:pointer;"
      onclick="(function(){ const b=document.getElementById('add-teacher-btn'); if(b) b.click(); })()">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M12 5v14M5 12h14"/>
      </svg>
    </button>

    <style>
      /* Card style used by grid children */
      .teachers-grid .card {
        background: #fff;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 6px 18px rgba(2,6,23,0.04);
        border: 1px solid rgba(15,23,42,0.03);
        display:flex;
        flex-direction:column;
        gap:8px;
      }

      /* Teacher card header row */
      .teacher-row {
        display:flex;
        align-items:center;
        gap:12px;
      }
      .teacher-avatar {
        width:48px;height:48px;border-radius:10px;background:#eef2ff;display:flex;align-items:center;justify-content:center;font-weight:700;color:#1e293b;font-size:16px;
      }
      .teacher-meta {
        flex:1; min-width:0;
      }
      .teacher-name { font-weight:700; font-size:15px; color:#0f172a; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
      .teacher-sub { font-size:13px; color:#64748b; }

      /* action row */
      .teacher-actions { display:flex; gap:8px; margin-top:8px; align-items:center; }
      .teacher-actions .btn { display:inline-grid; place-items:center; width:36px; height:36px; padding:0; border-radius:8px; border:0; cursor:pointer; background:transparent; color: #374151; }
      .teacher-actions .btn svg { display:block; }
      .teacher-actions .btn:hover { background: rgba(2,6,23,0.04); }

      /* fab visibility and responsive tweaks */
      @media (max-width: 900px) {
        /* show floating add button on mobile */
        #add-teacher-fab { display:flex; }

        /* make header controls more compact */
        .teachers-header { gap:8px; }
        #add-teacher-btn span { display:none; } /* hide label to save space on small screens */
        #add-teacher-btn { padding:10px; width:44px; height:44px; border-radius:10px; justify-content:center; }

        /* input should stretch full width */
        #teacher-search { min-width:0; flex:1; }
      }

      @media (min-width: 901px) {
        /* On larger screens ensure the header add button shows label */
        #add-teacher-btn span { display:inline-block; }
        #add-teacher-fab { display:none; }
      }

      /* small helper muted */
      .muted { color:#6b7280; font-size:13px; }

      /* example utility to hide empty state if JS populates list */
      .hidden { display:none !important; }
    </style>
  </section>
</template>

  <template id="tpl-classes">
    <section class="page">
      <h2>Classes <button id="add-class-btn" class="btn">Add Class</button></h2>
      <input id="class-search" placeholder="Search class name or id" />
      <div id="classes-list"></div>
    </section>
  </template>


  <template id="tpl-subjects">
    <section class="page">
      <h2>Subjects <button id="add-subject-btn" class="btn">Add Subject</button></h2>
      <input id="subject-search" placeholder="Search subject name or id" />
      <div id="subjects-list"></div>
    </section>
  </template>

<!-- Parent management template -->
<template id="tpl-parents">
  <section class="page" style="padding:12px;max-width:980px;margin:0 auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <h2 style="margin:0">Parents</h2>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="parent-search" placeholder="Search by parent name or student id" style="padding:8px;border-radius:6px;border:1px solid #ddd" />
        <button id="add-parent-btn" class="btn" style="padding:8px 12px;border-radius:6px;cursor:pointer">Add Parent</button>
      </div>
    </div>

    <!-- Add parent collapsible panel (hidden by default) -->
    <div id="add-parent-panel" style="margin-top:12px;display:none;border:1px solid #e6e6e6;padding:12px;border-radius:8px;background:#fff;">
      <h3 style="margin:0 0 8px 0">Add Parent</h3>
      <form id="add-parent-form" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <div style="display:flex;flex-direction:column">
          <label for="parent-fullname" style="font-size:13px;margin-bottom:6px">Parent full name</label>
          <input id="parent-fullname" name="fullname" required placeholder="e.g. Ahmed Ali" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label for="parent-phone" style="font-size:13px;margin-bottom:6px">Parent phone</label>
          <input id="parent-phone" name="phone" placeholder="+252 61 2345678" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label for="parent-email" style="font-size:13px;margin-bottom:6px">Email (optional)</label>
          <input id="parent-email" name="email" placeholder="parent@example.com" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label for="parent-password" style="font-size:13px;margin-bottom:6px">Password (for parent login)</label>
          <input id="parent-password" name="password" type="password" required placeholder="Choose a password (min 6 chars)" />
        </div>

        <div style="display:flex;flex-direction:column">
          <label for="parent-student-number" style="font-size:13px;margin-bottom:6px">Student numberId</label>
          <input id="parent-student-number" name="studentNumberId" required placeholder="Enter student's numberId (e.g. STD0507)" />
          <small class="muted" style="margin-top:6px;font-size:12px;color:#666">
            If the student doesn't exist you'll get an error on submit.
          </small>
        </div>

        <div style="grid-column: 1 / -1; display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button id="add-parent-cancel" type="button" class="btn btn--outline">Cancel</button>
          <button id="add-parent-submit" type="submit" class="btn">Save Parent</button>
        </div>
      </form>
      <div id="add-parent-feedback" style="margin-top:8px;font-size:13px;color:#d00;display:none"></div>
    </div>

    <!-- Parents list container -->
    <div id="parents-list" style="margin-top:16px;display:grid;gap:10px">
      <!-- Example empty state -->
      <div id="parents-empty" class="muted" style="padding:12px;border-radius:8px;border:1px dashed #eee;background:#fafafa">
        No parents yet. Click "Add Parent" to register a parent for a student.
      </div>
    </div>
  </section>


</template>

<!-- Payments template -->
<template id="tpl-payments">
  <section class="page payments-page" aria-labelledby="payments-heading" style="padding:12px;max-width:1100px;margin:0 auto;">
    <h2 id="payments-heading">Payments</h2>

    <!-- Landing / mode switch -->
    <div class="payments-landing" id="payments-landing" style="display:flex;gap:12px;flex-wrap:wrap;margin:10px 0">
      <button class="card payments-card payments-card--students" id="payments-card-students" aria-pressed="false" aria-label="Students payments">
        <div class="payments-card__title">Students</div>
        <div class="payments-card__summary" id="payments-students-summary">Loading…</div>
      </button>
      <button class="card payments-card payments-card--teachers" id="payments-card-teachers" aria-pressed="false" aria-label="Teachers payments">
        <div class="payments-card__title">Teachers</div>
        <div class="payments-card__summary" id="payments-teachers-summary">Loading…</div>
      </button>
    </div>

    <!-- Main app area (shows after selecting Students or Teachers) -->
    <div id="payments-app" class="payments-app" style="display:none; margin-top:12px;">
      <div class="payments-toolbar" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
        <button id="payments-back" class="btn btn--outline" aria-label="Back to overview">Back</button>
        <div style="flex:1;min-width:180px">
          <input id="payments-search" type="search" placeholder="Search by name or ID…" aria-label="Search by name or ID" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e5e7eb"/>
        </div>
        <div id="payments-role-actions" style="display:flex;gap:8px">
          <!-- manager-only: Add custom payment type -->
          <button id="add-payment-type-btn" class="btn" style="display:none">Manage types</button>
        </div>
      </div>

      <!-- Filter chips -->
      <div id="payments-chips" class="payments-chips" role="toolbar" aria-label="Filter by classes or departments" style="display:flex;gap:8px;overflow:auto;padding-bottom:8px">
        <!-- chips inserted here -->
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <!-- Left: list -->
        <div id="payments-list-wrap" style="flex:1;min-width:280px">
          <div id="payments-list" aria-live="polite">Loading…</div>
        </div>

        <!-- Right: quick detail (desktop only) -->
        <div id="payments-detail" style="width:320px;min-width:260px;display:none">
          <div class="card" id="payments-detail-card">Select a person to see summary</div>
        </div>
      </div>
    </div>

    <!-- Modals: markup container (app will inject modal content) -->
    <div id="payments-modal-root" aria-hidden="true"></div>
  </section>
</template>
<template id="tpl-zoom">
  <section class="page zoom-page" aria-labelledby="payments-heading" style="padding:12px;max-width:1100px;margin:0 auto;">
    <div id="zoom-app">
      <div id="zoom-toolbar" style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <button id="btn-toggle-audio" class="btn">Mute/Unmute</button>
        <button id="btn-toggle-video" class="btn">Camera</button>
        <button id="btn-share-screen" class="btn">Share Screen</button>
        <button id="btn-mute-all" class="btn" style="display:none">Mute All (host)</button>
        <div id="zoom-status" class="muted" style="margin-left:8px"></div>
      </div>
      <div id="videos" style="display:flex;flex-wrap:wrap;gap:8px"></div>
    </div>
  </section>
</template>



  <template id="tpl-exams">
    <section class="page">
      <h2>Exams <button id="add-exam-btn" class="btn">Add Exam</button></h2>
      <div id="exams-list"></div>
    </section>
  </template>

  <template id="tpl-results">
    <section class="page" style="padding:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 id="results-title" style="margin:0">Results</h2>
          <div id="results-sub" class="muted" style="font-size:13px">View student exam results</div>
        </div>
        <div id="results-controls" style="display:flex;gap:8px;align-items:center"></div>
      </div>
  
      <div id="results-student-card" style="margin-top:12px"></div>
  
      <div id="results-list" style="margin-top:12px"></div>
    </section>
  </template>
  
  <template id="tpl-help">
    <style>
      /* Compact styling for Help UI (matches existing app style) */
      :root { --muted:#6b7280; --card-bg:#fff; --panel-bg:#f8fafc; --border:#eef2f7; --primary:#0f172a; --danger:#ef4444; }
      .help-page-section { padding:12px; max-width:1100px; margin:0 auto; }
      .help-row { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
      .help-left { flex:1; min-width:320px; }
      .help-right { width:340px; min-width:260px; }
      .card { background:var(--card-bg); border-radius:8px; padding:12px; border:1px solid var(--border); box-shadow:0 6px 18px rgba(2,6,23,0.03); }
      #help-conversation { height:60vh; overflow:auto; padding:12px; }
      textarea#help-text { width:100%; font-size:14px; padding:8px; border-radius:6px; border:1px solid var(--border); min-height:60px; resize:vertical; }
      #help-messages { display:flex; flex-direction:column; gap:8px; }
      .help-msg.card { background:#fff; border-radius:10px; padding:12px; border:1px solid var(--border); box-shadow:0 6px 18px rgba(2,6,23,0.04); }
      .help-msg .help-text { font-size:14px; color:var(--primary); white-space:pre-wrap; }
      .help-reply-preview { background:#f1f5f9; padding:8px; border-radius:8px; color:#374151; font-size:13px; margin-bottom:6px; }
      .help-meta { margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
      .muted { color:var(--muted); }
      .small { font-size:12px; }
      .btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; background:var(--primary); color:#fff; font-weight:600; }
      .btn--outline { background:transparent; border:1px solid var(--border); color:var(--primary); }
      .btn--danger { background:var(--danger); color:#fff; }
      .ui-modal-overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,0.45); z-index:9999; }
      .ui-modal-open { display:flex !important; }
      .ui-modal { width:100%; max-width:860px; background:#fff; border-radius:12px; padding:18px; box-shadow:0 30px 80px rgba(2,6,23,0.45); max-height:80vh; overflow:auto; }
      .ui-modal-title { font-weight:700; margin-bottom:8px; font-size:18px; }
      .counter-pill { padding:6px 10px; background:#eef2ff; border-radius:999px; font-weight:600; color:var(--primary); }
      .small-muted { font-size:12px; color:var(--muted); }

      /* brief highlight for the newest message on first load */
.help-last {
  animation: help-flash 1.6s ease-in-out;
  box-shadow: 0 10px 30px rgba(16,24,40,0.12);
  border-color: #c7f3ff;
}
@keyframes help-flash {
  0% { transform: translateY(4px); background: #fff; }
  20% { background: #fffbeb; }
  60% { background: #fff; }
  100% { transform: translateY(0); background: #fff; }
}

    </style>
  
    <section class="page help-page-section">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Help / Support</h2>
        <div>
          <button id="btn-need-help" class="btn">Need Help</button>
        </div>
      </div>
  
      <div class="help-row">
        <!-- Left: conversation area -->
        <div class="help-left">
          <div class="card" id="help-conversation">
            <div id="help-messages" style="display:flex;flex-direction:column;gap:8px"></div>
          </div>
  
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <!-- manager-only container: JS will hide for non-managers -->
            <div id="help-target-wrapper">
              <select id="help-target-type" title="Send to" style="min-width:160px;border-radius:6px;padding:6px;border:1px solid var(--border);">
                <option value="manager">To Manager</option>
                <option value="student">To Students</option>
                <option value="teacher">To Teachers</option>
                <option value="">General</option>
              </select>
            </div>
            <div style="flex:1"></div>
            <div id="help-current-role" class="muted small"></div>
          </div>
  
          <div style="margin-top:8px">
            <textarea id="help-text" rows="3" placeholder="Describe your problem..."></textarea>
            <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:6px">
              <!-- private checkbox (visible to everyone) -->
              <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="help-private-checkbox"/> <span class="muted">Private (only managers will see)</span></label>
              <button id="help-send-btn" class="btn">Send</button>
            </div>
          </div>
        </div>
  
        <!-- Right: helpers panel -->
        <div class="help-right">
          <div class="card">
            <h3 style="margin:0">Help topics</h3>
            <div id="help-topics" style="margin-top:8px"></div>
          </div>
  
          <div class="card" style="margin-top:12px">
            <h3 style="margin:0">Legend</h3>
            <div class="muted" style="font-size:13px;margin-top:6px">Private messages are only visible to managers (and the sender/admin). Reactions and deletes are real-time.</div>
          </div>
        </div>
      </div>
    </section>
  </template>  
  
  
  <template id="tpl-quizzes">
    <section class="page">
      <h2>Quizzes <button id="add-quiz-btn" class="btn">Add Quiz</button></h2>
      <div id="quizzes-list"></div>
    </section>
  </template>

  <template id="tpl-reports">
    <section class="page">
      <h2>Reports</h2>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="reports-filter">
          <option value="monthly">Monthly</option>
          <option value="yearly">Yearly</option>
          <option value="all">All time</option>
        </select>
      </div>
      <div id="reports-list"></div>
    </section>
  </template>

  <template id="tpl-notices">
    <section class="page">
      <h2>Notices <button id="send-notice-btn" class="btn">Send Notice</button></h2>
      <div id="notices-list"></div>
    </section>
  </template>

  <template id="tpl-about">
    <section class="page">
      <h2>About</h2>
      <div class="card"><div id="about-text" class="muted">(loading...)</div></div>
    </section>
  </template>

  <template id="tpl-profile">
    <section class="page" style="max-width:900px;margin:0 auto;padding:12px">
      <h2>My Profile</h2>
  
      <div id="profile-card" class="card" style="display:flex;flex-direction:column;gap:12px;padding:16px">
        <!-- Content populated by JS -->
        <div id="profile-loading" class="muted">Loading profile...</div>
      </div>
  
      <!-- <div style="margin-top:12px;display:flex;gap:8px">
         <button id="edit-profile-btn" class="btn">Edit profile</button> 
         <button id="change-password-btn" class="btn">Change password</button> 
      </div> -->
    </section>
  </template>
  
  <template id="tpl-user-management">
    <section class="page">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <h2>User Management</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="manager-search" placeholder="Search managers by name or email" style="padding:6px;border-radius:6px;border:1px solid #e5e7eb" />
          <button id="create-manager-btn" class="btn">Create Manager</button>
        </div>
      </div>
  
      <div id="user-management-list" style="margin-top:12px"></div>
  
      <!-- optional pagination area -->
      <div id="user-management-pager" style="margin-top:12px"></div>
    </section>
  </template>
  <template id="tpl-attendance">
    <section class="page" style="padding-bottom:24px">
    <!-- Minimal attendance template: store this where tpl('attendance') reads from -->
<div id="attendance-root" style="padding:12px;">
  <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:12px">
    <h2 style="margin:0">Attendance</h2>
    <div style="margin-left:auto;display:flex;gap:8px">
      <button id="att-view-cards" class="btn">Cards</button>
      <button id="att-view-list" class="btn">List</button>
    </div>
  </div>

  <div id="attendance-cards" style="display:block"></div>

  <div id="attendance-controls" style="display:none;margin-top:12px">
    <!-- optional list controls -->
    <div style="display:flex;gap:8px;align-items:center">
      <label>Class</label>
      <select id="att-list-class"></select>
      <label>Date</label>
      <input id="att-list-date" type="date" value="">
      <button id="att-list-refresh" class="btn">Refresh</button>
    </div>
  </div>

  <div id="attendance-list" style="display:none;margin-top:12px"></div>

  <div id="attendance-student-view" style="display:none;margin-top:12px"></div>
</div>

    </section>
  </template>
  
  <template id="tpl-vote">
    <section class="page" style="padding:12px;">
      <h2>Vote
        <button id="create-vote-btn" class="btn">Create Vote</button>
      </h2>
  
      <div id="vote-list"></div>
  
      <!-- modal area (JS will create a modal too) -->
      <div id="vote-modal-root" aria-hidden="true"></div>
    </section>
  </template>
  
  <!-- Optional small CSS for candidate preview inside tpl -->
  <style>
    .candidates-wrap { display:block; margin-top:8px; }
    .candidate-row { display:grid; grid-template-columns: 1fr 1fr 1fr 80px; gap:8px; align-items:center; margin-bottom:8px; padding:8px; border-left:3px solid rgba(0,0,0,0.06); }
    .candidate-photo-preview { width:96px; height:64px; object-fit:cover; border-radius:6px; }
    .photo-choose-btn { display:block; margin-top:6px; }
    .muted { color:#666; font-size:13px; }
    .btn { padding:6px 10px; cursor:pointer; }
  </style>
  
  
  <template id="tpl-login">
    <section class="page auth">
      <h2>Login</h2>
      <form id="login-form">
        <input name="email" placeholder="email" required />
        <input name="password" type="password" placeholder="password" required />
        <button type="submit" class="btn">Login</button>
      </form>
      <p style="margin-top:10px">No account? <a id="go-register" href="javascript:;">Register here</a></p>
    </section>
  </template>

  <template id="tpl-register">
    <section class="page auth">
      <h2>Register (Manager only)</h2>
      <form id="register-form" style="max-width:420px">
        <input name="fullname" placeholder="School/University Name" required autocomplete="name" />
        <input name="email" placeholder="Email" required type="email" autocomplete="email" />
        <input name="password" type="password" placeholder="Password (min 6 chars)" required autocomplete="new-password" />
        <!-- Hidden role: only allow manager registration from public form -->
        <input type="hidden" name="role" value="manager" />
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button type="submit" id="register-submit" class="btn">Register</button>
        </div>
      </form>
  
      <p style="margin-top:12px" class="muted">
        Note: This Email registration will be your username... 
  
      <p style="margin-top:10px">Have an account? <a id="go-login" href="javascript:;">Login</a></p>
    </section>
  </template>
  

  <!-- Modal -->
  <div id="modal" class="modal hidden">
    <div class="modal-dialog">
      <button id="modal-close" class="close">×</button>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- One-time initial password modal -->
<div id="initial-pw-modal" class="modal hidden" style="align-items:center;justify-content:center;">
  <div class="modal-dialog" style="max-width:520px;padding:18px;position:relative">
    <button id="initial-pw-close" class="close">×</button>
    <div id="initial-pw-body">
      <h3 style="margin-top:0">Initial password — show once</h3>
      <p id="initial-pw-text" style="font-weight:700;word-break:break-all;font-size:16px"></p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="copy-pw-btn" class="btn btn--outline">Copy</button>
        <a id="mailto-pw" href="#" style="text-decoration:none"><button class="btn btn--outline">Open Email</button></a>
        <button id="close-pw-btn" class="btn">Done</button>
      </div>
      <p style="margin-top:10px;color:#444;font-size:13px">This password will not be stored on the server; copy it and deliver securely. The server will not return it again.</p>
    </div>
  </div>
</div>

<!-- put this BEFORE <script src="js/api.js"></script> -->
<script>
  // Production (Netlify) should set this to your Render backend (no trailing /api).
  // On local dev you can comment this line out to let api.js default to localhost.
  window.BACKEND_URL = "https://study-helper-b11e.onrender.com";
</script>

<!-- socket.io client (must appear before api.js if you want socket enabled on page load) -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- chart library (optional, ok to keep here) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- REMOVE any stray/no-op scripts like: <script>'http://127.0.0.1:5000/api';</script> -->
<!-- REMOVE window.SERVER_BASE unless you need it and keep consistent values -->

<!-- Now load your client helper which will init the socket using BACKEND_URL -->
<script src="js/api.js"></script>
<script src="js/app.js"></script>

</body>
</html>
